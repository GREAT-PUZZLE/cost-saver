<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Great Puzzle - ESG Cost Simulator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
        (function() { emailjs.init("rMKdHnzyb418h9t0V"); })();
    </script>
    
    <script>
        // â–¼â–¼â–¼ í•µì‹¬ ê°€ê²© ì„¤ì • (ìˆ˜ì •ë¨: êµ¬ë§¤í˜• ìµœì €ê°€ ë³´ì¥ì„ ìœ„í•œ ìŠ¤ì¼€ì¼ë§) â–¼â–¼â–¼
        // ì„¤ëª…: í• ì¸ìœ¨(10~13%)ì„ ì ìš©í•´ë„ êµ¬ë§¤í˜•ì´ ê°€ì¥ ì €ë ´í•˜ë„ë¡ ë Œíƒˆ/í•˜ì´ë¸Œë¦¬ë“œ ë² ì´ìŠ¤ ê°€ê²© í˜„ì‹¤í™”
        const BASE_CONFIG = {
            labor: 1030000,          // ì¸ê±´ë¹„ (ê³ ì •)
            purchaseListPrice: 36500000, // ê¸°ê¸° ì •ê°€ (êµ¬ë§¤í˜•)
            purchaseOp: 750000,      // ìš´ì˜ë¹„ (ê³µí†µ)
            
            // [ê°€ê²© ì¡°ì •] ë Œíƒˆì´ ê°€ì¥ ë¹„ì‹¼ êµ¬ì¡°ë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•´ ì›” ë Œíƒˆë£Œ ë² ì´ìŠ¤ ìƒí–¥
            rentalMonthly: 2100000,  
            
            // [ê°€ê²© ì¡°ì •] í•˜ì´ë¸Œë¦¬ë“œê°€ ì¤‘ê°„ ê°€ê²©ì„ ìœ ì§€í•˜ê¸° ìœ„í•´ ì›”ì„¸/ë³´ì¦ê¸ˆ ë°¸ëŸ°ìŠ¤ ì¡°ì •
            hybridDeposit: 15000000, 
            hybridRent: 900000       
        };

        // ë¶€ë‹´ê¸ˆ êµ¬ê°„ (ë²•ì  ê¸°ì¤€ - ìˆ˜ì • ê¸ˆì§€)
        const BURDEN_TIERS = [
            { limit: 0, cost: 2096000 },    
            { limit: 0.25, cost: 1761000 }, 
            { limit: 0.50, cost: 1509600 }, 
            { limit: 0.75, cost: 1333500 }, 
            { limit: 1.0, cost: 1258000 }   
        ];
    </script>

    <style>
        /* â–¼â–¼â–¼ ìŠ¤íƒ€ì¼ ì •ì˜ (ì „ì²´ ìœ ì§€) â–¼â–¼â–¼ */
        :root { 
            --primary: #2563eb; 
            --bg: #f8fafc; 
            --text: #334155; 
            --border: #e2e8f0; 
            --accent: #10b981; 
            --danger: #ef4444; 
            --dark: #1e293b;
        }

        body { 
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif; 
            background: var(--bg); 
            color: var(--text); 
            margin: 0; 
            padding: 20px; 
            line-height: 1.5; 
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.05); 
            padding: 40px; 
            position: relative; 
        }
        
        header { 
            text-align: center; 
            margin-bottom: 40px; 
        }
        
        header h1 { 
            margin: 0; 
            font-size: 2rem; 
            color: #1e293b; 
            font-weight: 900; 
        }

        .badge-container { 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
            gap: 10px; 
            margin-top: 20px; 
        }

        .cert-badge {
            background: white; 
            color: #64748b; 
            padding: 8px 16px; 
            border-radius: 50px; 
            cursor: pointer;
            font-size: 0.9rem; 
            font-weight: 700; 
            border: 1px solid #cbd5e1; 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            transition: all 0.2s ease;
        }

        .cert-badge:hover { 
            transform: translateY(-2px); 
            border-color: var(--primary); 
            color: var(--primary); 
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.1); 
        }

        .cert-badge.active { 
            background: #eff6ff; 
            color: #2563eb; 
            border-color: #2563eb; 
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2); 
        }

        .badge-icon { 
            width: 8px; 
            height: 8px; 
            border-radius: 50%; 
            background: currentColor; 
        }

        #cert-display-area {
            max-height: 0; 
            overflow: hidden; 
            transition: all 0.5s ease-in-out; 
            opacity: 0;
            background: #f8fafc; 
            border-radius: 16px; 
            margin-bottom: 20px;
        }

        #cert-display-area.show { 
            max-height: 600px; 
            opacity: 1; 
            margin-bottom: 40px; 
            border: 1px solid #e2e8f0; 
            padding: 30px; 
        }

        .cert-visual {
            background: white; 
            border: 1px solid #e2e8f0; 
            padding: 40px; 
            max-width: 600px; 
            margin: 0 auto;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05); 
            text-align: center; 
            position: relative; 
            border-radius: 8px;
        }

        .cert-title { 
            font-size: 1.8rem; 
            font-weight: 900; 
            margin-bottom: 25px; 
            color: #1e293b; 
            border-bottom: 3px solid #1e293b; 
            display: inline-block; 
            padding-bottom: 10px;
        }

        .cert-content { 
            font-size: 1.1rem; 
            line-height: 1.8; 
            color: #475569; 
            text-align: left; 
            padding: 0 20px; 
            word-break: keep-all; 
        }

        .input-section { 
            background: #eff6ff; 
            padding: 30px; 
            border-radius: 16px; 
            margin-bottom: 30px; 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 40px; 
            border: 1px solid #bfdbfe; 
        }

        .input-group label { 
            font-weight: 800; 
            display: block; 
            margin-bottom: 12px; 
            color: #1e40af; 
            font-size: 1.1rem; 
        }

        .input-row { 
            display: flex; 
            gap: 15px; 
            align-items: center; 
        }

        .input-row input[type=range] { 
            flex-grow: 1; 
            cursor: pointer; 
            height: 8px; 
            accent-color: var(--primary); 
        }

        .input-row input[type=number] { 
            width: 120px; 
            padding: 12px; 
            border: 2px solid #93c5fd; 
            border-radius: 8px; 
            text-align: right; 
            font-weight: 800; 
            font-size: 1.2rem; 
            color: #1e3a8a; 
        }

        .result-layout { 
            display: none; 
            grid-template-columns: 350px 1fr; 
            gap: 30px; 
            margin-top: 40px; 
            animation: fadeIn 0.6s ease-out; 
        }
        
        .info-card { 
            border: 1px solid var(--border); 
            border-radius: 16px; 
            padding: 25px; 
            background: white; 
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); 
        }

        .card-title { 
            font-weight: 800; 
            color: #64748b; 
            margin-bottom: 20px; 
            display: block; 
            font-size: 1rem; 
            border-bottom: 2px solid #f1f5f9; 
            padding-bottom: 10px; 
        }

        .stat-row { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 15px; 
            font-size: 1rem; 
            color: #475569; 
        }

        .stat-val { 
            font-weight: 800; 
            color: #0f172a; 
            font-size: 1.1rem; 
        }

        .highlight-red { 
            color: #ef4444; 
            font-size: 1.4rem; 
        }

        .discount-table { 
            width: 100%; 
            border-collapse: collapse; 
            font-size: 0.9rem; 
            text-align: center; 
        }

        .discount-table th { 
            background: #f8fafc; 
            padding: 10px; 
            border: 1px solid #e2e8f0; 
            color: #64748b; 
            font-weight: 700; 
        }

        .discount-table td { 
            padding: 10px; 
            border: 1px solid #e2e8f0; 
            color: #334155; 
        }

        .active-tier { 
            background: #eff6ff; 
            font-weight: 800; 
            color: var(--primary); 
            border: 2px solid var(--primary) !important; 
            position: relative; 
            z-index: 1; 
            box-shadow: 0 0 10px rgba(37,99,235,0.1); 
        }

        .mode-tabs { 
            display: flex; 
            gap: 10px; 
            margin-bottom: 20px; 
        }

        .tab-btn { 
            padding: 12px 24px; 
            border: 1px solid #cbd5e1; 
            background: white; 
            border-radius: 50px; 
            cursor: pointer; 
            font-weight: 700; 
            color: #64748b; 
            transition: 0.2s; 
        }

        .tab-btn.active { 
            background: #1e293b; 
            color: white; 
            border-color: #1e293b; 
            box-shadow: 0 4px 10px rgba(30, 41, 59, 0.3); 
        }

        .target-grid { 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap: 10px; 
            margin-bottom: 20px; 
            background: #f8fafc; 
            padding: 20px; 
            border-radius: 16px; 
            border: 1px solid #e2e8f0; 
        }

        .target-btn { 
            padding: 15px; 
            border: 1px solid #cbd5e1; 
            background: white; 
            border-radius: 12px; 
            cursor: pointer; 
            transition: 0.2s; 
            font-weight: 700; 
            color: #64748b; 
        }

        .target-btn:hover { 
            border-color: var(--primary); 
            color: var(--primary); 
            transform: translateY(-2px); 
        }

        .target-btn.selected { 
            background: var(--primary); 
            color: white; 
            border-color: var(--primary); 
            box-shadow: 0 4px 10px rgba(37,99,235,0.3); 
        }

        .result-box { 
            border: 2px solid #bfdbfe; 
            background: #eff6ff; 
            border-radius: 16px; 
            padding: 30px; 
            position: relative; 
        }

        .result-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 30px; 
            row-gap: 20px; 
            margin-bottom: 25px; 
        }

        .res-item { 
            display: flex; 
            flex-direction: column; 
        }

        .res-label { 
            font-size: 0.9rem; 
            color: #1e40af; 
            font-weight: 700; 
            margin-bottom: 5px; 
        }

        .res-value { 
            font-size: 1.6rem; 
            font-weight: 900; 
            color: #1e3a8a; 
            letter-spacing: -0.5px; 
        }

        .res-sub { 
            font-size: 0.85rem; 
            color: #60a5fa; 
            margin-top: 5px; 
        }

        .savings-highlight { 
            background: #1e293b; 
            color: white; 
            border-radius: 12px; 
            padding: 20px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            box-shadow: 0 10px 20px rgba(30, 41, 59, 0.2); 
            margin-top: 10px;
        }

        .savings-title { 
            font-size: 1.1rem; 
            font-weight: 700; 
            color: #94a3b8; 
        }

        .savings-amount { 
            font-size: 1.8rem; 
            font-weight: 900; 
            color: #4ade80; 
        }

        .savings-rate-badge { 
            background: #4ade80; 
            color: #064e3b; 
            padding: 4px 10px; 
            border-radius: 4px; 
            font-size: 0.9rem; 
            font-weight: 800; 
            margin-left: 10px; 
            vertical-align: middle; 
        }

        .chart-area { 
            height: 350px; /* ì°¨íŠ¸ ë†’ì´ ìœ ì§€ */
            margin-top: 30px; 
            background: white; 
            padding: 20px; 
            border-radius: 16px; 
            border: 1px solid #e2e8f0; 
        }

        .btn-main { 
            width: 100%; 
            padding: 20px; 
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); 
            color: white; 
            border: none; 
            border-radius: 12px; 
            font-size: 1.3rem; 
            font-weight: 800; 
            cursor: pointer; 
            transition: transform 0.2s, box-shadow 0.2s; 
            box-shadow: 0 10px 20px rgba(37,99,235,0.25); 
        }

        .btn-main:hover { 
            transform: translateY(-3px); 
            box-shadow: 0 15px 30px rgba(37,99,235,0.35); 
        }

        .modal-overlay { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0, 0, 0, 0.75); 
            backdrop-filter: blur(8px); 
            z-index: 9999; 
            display: none; 
            justify-content: center; 
            align-items: center; 
        }

        .modal-content { 
            background: white; 
            width: 95%; 
            max-width: 1100px; 
            border-radius: 24px; 
            padding: 50px; 
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25); 
            animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1); 
            text-align: center; 
            position: relative; 
            max-height: 90vh; 
            overflow-y: auto;
        }

        @keyframes slideUp { 
            from { transform: translateY(50px); opacity: 0; } 
            to { transform: translateY(0); opacity: 1; } 
        }
        
        .modal-header h2 { 
            font-size: 2.2rem; 
            margin: 0 0 15px; 
            color: #1e293b; 
            font-weight: 900; 
        }

        .solution-grid { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 25px; 
            margin: 40px 0; 
        }

        .sol-card { 
            background: #f8fafc; 
            border: 1px solid #e2e8f0; 
            border-radius: 20px; 
            padding: 30px; 
            text-align: center; 
            transition: 0.3s; 
        }

        .sol-card:hover { 
            transform: translateY(-5px); 
            border-color: var(--primary); 
            box-shadow: 0 15px 30px rgba(0,0,0,0.08); 
        }

        .sol-icon { 
            font-size: 3.5rem; 
            margin-bottom: 20px; 
            display: block; 
        }

        .sol-title { 
            font-weight: 800; 
            font-size: 1.3rem; 
            margin-bottom: 20px; 
            display: block; 
            color: #1e293b; 
        }

        .sol-list { 
            list-style: none; 
            padding: 0; 
            margin: 0; 
            text-align: left; 
            font-size: 0.95rem; 
            color: #475569; 
            line-height: 1.6; 
        }

        .sol-list li { 
            margin-bottom: 10px; 
            padding-left: 24px; 
            position: relative; 
        }

        .sol-list li::before { 
            content: "âœ”"; 
            color: #10b981; 
            position: absolute; 
            left: 0; 
            font-weight: 900; 
        }
        
        .modal-btn { 
            width: 100%; 
            padding: 22px; 
            background: #2563eb; 
            color: white; 
            border: none; 
            border-radius: 16px; 
            font-size: 1.4rem; 
            font-weight: 800; 
            cursor: pointer; 
            transition: 0.2s; 
        }

        .modal-btn:hover { 
            background: #1e40af; 
            transform: scale(1.01); 
        }

        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(20px); } 
            to { opacity: 1; transform: translateY(0); } 
        }

        @media (max-width: 768px) {
            .container { padding: 20px; width: auto; margin: 10px; }
            header h1 { font-size: 1.5rem; }
            .input-section { grid-template-columns: 1fr; gap: 20px; padding: 20px; }
            .result-layout { grid-template-columns: 1fr; margin-top: 30px; }
            .result-grid { grid-template-columns: 1fr 1fr; gap: 15px; } 
            .res-value { font-size: 1.3rem; }
            .target-grid { grid-template-columns: repeat(2, 1fr); }
            .solution-grid { grid-template-columns: 1fr; }
            .modal-content { padding: 25px; width: 85%; }
            .savings-amount { font-size: 1.4rem; }
            .info-card, .result-box, .chart-area { padding: 20px; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ESG ë¹„ìš© ì ˆê° ì‹œë®¬ë ˆì´í„°</h1>
        <p style="color:#64748b; font-size:1.1rem; margin-top:10px;">Great Puzzle Solution (ì¥ì• ì¸ ê³ ìš©ë¶€ë‹´ê¸ˆ ì ˆê° & Rasset ESG ì „ëµ)</p>
        
        <div class="badge-container">
            <div class="cert-badge" onclick="showCert('innoprod', this)"><div class="badge-icon"></div>ì¡°ë‹¬ì²­ í˜ì‹ ì œí’ˆ ì§€ì •</div>
            <div class="cert-badge" onclick="showCert('pilot', this)"><div class="badge-icon"></div>ì¤‘ê¸°ë¶€ ì‹œë²”êµ¬ë§¤ ì„ ì •</div>
            <div class="cert-badge" onclick="showCert('venture', this)"><div class="badge-icon"></div>ë²¤ì²˜ê¸°ì—… ì¸ì¦</div>
            <div class="cert-badge" onclick="showCert('social', this)"><div class="badge-icon"></div>ì†Œì…œë²¤ì²˜ íŒë³„</div>
        </div>
    </header>

    <div id="cert-display-area">
        <div class="cert-visual">
            <div class="cert-title" id="cert-title-text">ì¸ì¦ì„œ ì œëª©</div>
            <div class="cert-content" id="cert-content-text">ë‚´ìš©</div>
            <div class="cert-seal"></div>
        </div>
    </div>

    <div class="input-section">
        <div class="input-group">
            <label>ğŸ¢ ì „ì²´ ìƒì‹œ ê·¼ë¡œì ìˆ˜</label>
            <div class="input-row">
                <input type="range" id="range-total" min="50" max="3000" step="10" value="1000" oninput="syncVal('total', this.value)">
                <input type="number" id="input-total" value="1000" oninput="syncVal('total', this.value)">
            </div>
        </div>
        <div class="input-group">
            <label>â™¿ í˜„ì¬ ì¥ì• ì¸ ê·¼ë¡œì ìˆ˜ (ì¸ì • ì¸ì›)</label>
            <div class="input-row">
                <input type="range" id="range-dis" min="0" max="100" step="1" value="0" oninput="syncVal('dis', this.value)">
                <input type="number" id="input-dis" value="0" oninput="syncVal('dis', this.value)">
            </div>
        </div>
    </div>

    <button class="btn-main" onclick="openPopup()">ğŸ“Š ë¶„ì„ ê²°ê³¼ í™•ì¸í•˜ê¸°</button>

    <div id="resultArea" class="result-layout">
        <div class="left-panel">
            <div class="info-card">
                <span class="card-title">ğŸ“Š í˜„ì¬ ë¹„ìš© ë¶„ì„ (ë„ì… ì „)</span>
                <div class="stat-row">
                    <span>ì˜ë¬´ ê³ ìš© ì¸ì›</span>
                    <span class="stat-val"><span id="val-mandatory">0</span>ëª…</span>
                </div>
                <div class="stat-row">
                    <span>í˜„ì¬ ì¸ì • ì¸ì›</span>
                    <span class="stat-val"><span id="val-current">0</span>ëª…</span>
                </div>
                <div class="stat-row">
                    <span>ë¯¸ë‹¬ ì¸ì› (íŒ¨ë„í‹°)</span>
                    <span class="stat-val text-danger"><span id="val-unfilled">0</span>ëª…</span>
                </div>
                <div class="stat-row">
                    <span>ì ìš© ë¶€ë‹´ê¸ˆ ë‹¨ê°€</span>
                    <span class="stat-val"><span id="val-unit">0</span>ë§Œì›</span>
                </div>
                <div style="border-top:1px dashed #cbd5e1; margin:15px 0;"></div>
                <div class="stat-row">
                    <span>5ë…„ ëˆ„ì  ë¶€ë‹´ê¸ˆ</span>
                    <span class="stat-val highlight-red" id="val-5yLevy">0ì›</span>
                </div>
                <div id="exempt-msg" style="display:none; color:#2563eb; font-size:0.85rem; margin-top:15px; text-align:center; font-weight:bold; background:#eff6ff; padding:10px; border-radius:8px;">
                    â€» 100ì¸ ë¯¸ë§Œ ì‚¬ì—…ì¥ì€ ë¶€ë‹´ê¸ˆ ë‚©ë¶€ ì˜ë¬´ê°€ ì—†ìŠµë‹ˆë‹¤.<br>(ê³ ìš© ì¥ë ¤ê¸ˆ ìˆ˜ë ¹ ê°€ëŠ¥ ëŒ€ìƒ)
                </div>
            </div>

            <div class="info-card">
                <span class="card-title">ğŸ’¡ ëŒ€ëŸ‰ ë„ì… í• ì¸í‘œ (êµ¬ë§¤í˜•)</span>
                <table class="discount-table">
                    <thead>
                        <tr><th>ëŒ€ìˆ˜</th><th>í• ì¸ìœ¨</th><th>ê¸°ê¸°ê°’(1ëŒ€)</th></tr>
                    </thead>
                    <tbody>
                        <tr id="row-t1"><td>1~10</td><td>0%</td><td>3,650ë§Œ</td></tr>
                        <tr id="row-t2"><td>11~20</td><td>15%</td><td>3,102ë§Œ</td></tr>
                        <tr id="row-t3"><td>21~30</td><td>20%</td><td>2,920ë§Œ</td></tr>
                        <tr id="row-t4"><td>31~</td><td>25%</td><td>2,737ë§Œ</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="right-panel">
            <div class="mode-tabs">
                <button class="tab-btn active" onclick="setMode('purchase', this)">êµ¬ë§¤í˜• (ì¶”ì²œ)</button>
                <button class="tab-btn" onclick="setMode('hybrid', this)">í•˜ì´ë¸Œë¦¬ë“œ</button>
                <button class="tab-btn" onclick="setMode('rental', this)">ë Œíƒˆí˜•</button>
            </div>

            <div style="background:white; border:1px solid #e2e8f0; padding:15px; border-radius:16px;">
                <span class="card-title" style="border:none; margin-bottom:10px;">ğŸ¯ ëª©í‘œ ë‹¬ì„±ë¥  ì„ íƒ</span>
                <div class="target-grid">
                    <button class="target-btn" onclick="setTarget(0.25, this)">25% ì¶©ì¡±</button>
                    <button class="target-btn" onclick="setTarget(0.50, this)">50% ì¶©ì¡±</button>
                    <button class="target-btn" onclick="setTarget(0.75, this)">75% ì¶©ì¡±</button>
                    <button class="target-btn selected" onclick="setTarget(1.0, this)">100% (ì™„ì „í•´ê²°)</button>
                </div>
            </div>

            <div class="result-box">
                <div class="result-grid">
                    <div class="res-item">
                        <span class="res-label">í•„ìš” ê³ ìš© ì¸ì› (ì¤‘ì¦)</span>
                        <div class="res-value" id="sol-hires">0 ëª…</div>
                        <span class="res-sub" id="sol-logic-text">ë¯¸ë‹¬ì¸ì› Ã· 2ë°°ìˆ˜</span>
                    </div>
                    <div class="res-item">
                        <span class="res-label">ì†”ë£¨ì…˜ ì›” ë¹„ìš©</span>
                        <div class="res-value" id="sol-monthly">0 ì›</div>
                        <span class="res-sub">ì¸ê±´ë¹„ + ê¸°ê¸°/ìš´ì˜ë¹„ í¬í•¨</span>
                    </div>
                    <div class="res-item">
                        <span class="res-label">ì”ì—¬ ë¶€ë‹´ê¸ˆ (ì›”)</span>
                        <div class="res-value" style="color:#64748b;" id="sol-remain">0 ì›</div>
                        <span class="res-sub">ëª©í‘œ ë‹¬ì„± í›„ ë‚¨ì€ íŒ¨ë„í‹°</span>
                    </div>
                    <div class="res-item">
                        <span class="res-label">5ë…„ ì´ ë¹„ìš© (TCO)</span>
                        <div class="res-value" style="color:#1e293b;" id="sol-total5y">0 ì›</div>
                        <span class="res-sub">ì´ˆê¸° ë„ì…ë¹„ + 60ê°œì›” ìš´ì˜ë¹„</span>
                    </div>
                </div>

                <div class="savings-highlight">
                    <span class="savings-title">ğŸ’° ì˜ˆìƒ ì ˆê°ì•¡ (5ë…„)</span>
                    <div>
                        <span class="savings-amount" id="final-savings">0 ì›</span>
                        <span class="savings-rate-badge" id="final-rate">0%</span>
                    </div>
                </div>
            </div>

            <div class="chart-area">
                <canvas id="costChart"></canvas>
            </div>
        </div>
    </div>
</div>

<div id="solutionPopup" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Great Puzzle Solution</h2>
            <p>í˜ì‹  ê¸°ìˆ ê³¼ ë°ì´í„°ë¡œ ESG ê²½ì˜ì˜ ìƒˆë¡œìš´ í•´ë‹µì„ ì œì‹œí•©ë‹ˆë‹¤.</p>
        </div>

        <div class="solution-grid">
            <div class="sol-card">
                <span class="sol-icon">ğŸ¤–</span>
                <span class="sol-title">AI ë¡œë´‡ ì†”ë£¨ì…˜<br>(PETSPOT)</span>
                <ul class="sol-list">
                    <li>íˆ¬ëª… í˜íŠ¸ë³‘ ë¬´ì¸ íšŒìˆ˜ & íŒŒì‡„</li>
                    <li><strong style="color:#2563eb">ë¶€í”¼ 1/10 ê°ì¶•</strong> (ë¬¼ë¥˜ë¹„ ì ˆê°)</li>
                    <li>ê³µì • í˜ì‹ : 15ë‹¨ê³„ â†’ 4ë‹¨ê³„</li>
                    <li>ì¸í”„ë¼ íˆ¬ì: 100ì–µ â†’ 5~10ì–µ</li>
                    <li>ì—ë„ˆì§€ ì ˆê° 80% ì´ìƒ</li>
                </ul>
            </div>
            <div class="sol-card" style="border-color:#2563eb; background:#eff6ff;">
                <span class="sol-icon">âš™ï¸</span>
                <span class="sol-title">ì¤‘ì¦ ì¥ì• ì¸ ì§ë¬´<br>(All-in-One)</span>
                <ul class="sol-list">
                    <li><strong style="color:#2563eb">ì¤‘ì¦ 2ë°°ìˆ˜ ì¸ì • ì§ë¬´ ê°œë°œ</strong></li>
                    <li>í‘œì¤€ ê·¼ë¡œê³„ì•½ ë° í–‰ì • ëŒ€í–‰</li>
                    <li>GPS ê¸°ë°˜ ê·¼íƒœê´€ë¦¬ ì•± ì œê³µ</li>
                    <li>ì‹¤ì‹œê°„ ì—…ë¬´ ì§€ì‹œ & ëª¨ë‹ˆí„°ë§</li>
                    <li>ê³ ìš©ë…¸ë™ë¶€ ì‹ ê³  ì„œë¥˜ ìë™í™”</li>
                </ul>
            </div>
            <div class="sol-card">
                <span class="sol-icon">ğŸ“Š</span>
                <span class="sol-title">ESG ë°ì´í„°<br>& ì‚¬íšŒ ê³µí—Œ</span>
                <ul class="sol-list">
                    <li><strong style="color:#2563eb">íˆ¬ëª… í˜íŠ¸ë³‘ íšŒìˆ˜ëŸ‰</strong> ì§‘ê³„</li>
                    <li>ì‹¤ì‹œê°„ íƒ„ì†Œ ì €ê°ëŸ‰ ë°ì´í„°</li>
                    <li>ì‚¬ìš©ì í¬ì¸íŠ¸ ê¸°ë¶€/ì ë¦½ í˜„í™©</li>
                    <li>ê¸°ë¶€ê¸ˆ í™œìš© ë‚´ì—­ íˆ¬ëª…ì„± ë¦¬í¬íŠ¸</li>
                    <li>ì¥ì• ì¸ ê³ ìš© ì„±ê³¼ ì§€í‘œ ê´€ë¦¬</li>
                </ul>
            </div>
        </div>

        <button class="modal-btn" onclick="closePopupAndShowResult()">
            ğŸš€ ì˜ˆìƒ ì ˆê°ì•¡ í™•ì¸í•˜ê¸° (Click)
        </button>
    </div>
</div>

<script>
    // ì „ì—­ ìƒíƒœ ë³€ìˆ˜
    let state = { total: 1000, dis: 0, mode: 'purchase', targetRate: 1.0 };
    let myChart = null;

    // ì¸ì¦ì„œ ë°ì´í„°
    const certData = {
        'innoprod': {
            title: "í˜ì‹ ì œí’ˆ ì§€ì • ì¸ì¦ì„œ",
            content: "<strong>ì¸ì¦ë²ˆí˜¸:</strong> ì œ 2025-020í˜¸<br><strong>ì œí’ˆëª…:</strong> AI íˆ¬ëª… í˜íŠ¸ë³‘ ë¬´ì¸ ë¶„ì‡„ ë¡œë´‡<br><strong>ì§€ì •ê¸°ê°„:</strong> 2025.03.12 ~ 2028.03.11<br><strong>ë°œê¸‰ê¸°ê´€:</strong> ì¡°ë‹¬ì²­ì¥<br><br>ìœ„ ì œí’ˆì€ ã€Œì¡°ë‹¬ì‚¬ì—…ì— ê´€í•œ ë²•ë¥ ã€ì— ë”°ë¼ í˜ì‹ ì œí’ˆìœ¼ë¡œ ì§€ì •ë˜ì—ˆìŒì„ ì¸ì¦í•©ë‹ˆë‹¤."
        },
        'pilot': {
            title: "ê¸°ìˆ ê°œë°œì œí’ˆ ì‹œë²”êµ¬ë§¤ ì œí’ˆ ì„ ì •",
            content: "<strong>ë¶„ë¥˜ë²ˆí˜¸:</strong> 2025-00595<br><strong>ì œí’ˆëª…:</strong> GP-902 (ì‹ë³„ë²ˆí˜¸: 25544592)<br><strong>ìœ íš¨ê¸°ê°„:</strong> 2025.12.08 ~ 2028.03.11<br><strong>ë°œê¸‰ê¸°ê´€:</strong> ì¤‘ì†Œë²¤ì²˜ê¸°ì—…ë¶€<br><br>ê·€ì‚¬ì˜ ì œí’ˆì´ ê¸°ìˆ ê°œë°œì œí’ˆ ì‹œë²”êµ¬ë§¤ ëŒ€ìƒìœ¼ë¡œ ì„ ì •ë˜ì—ˆìŒì„ í™•ì¸í•©ë‹ˆë‹¤."
        },
        'venture': {
            title: "ë²¤ì²˜ê¸°ì—… í™•ì¸ì„œ",
            content: "<strong>í™•ì¸ë²ˆí˜¸:</strong> ì œ 20250108030080í˜¸<br><strong>í™•ì¸ìœ í˜•:</strong> í˜ì‹ ì„±ì¥ìœ í˜•<br><strong>ê¸°ì—…ëª…:</strong> ì£¼ì‹íšŒì‚¬ ê·¸ë ˆì´íŠ¸í¼ì¦<br><strong>ìœ íš¨ê¸°ê°„:</strong> 2024.12.08 ~ 2027.12.07<br><br>ìœ„ ê¸°ì—…ì€ ã€Œë²¤ì²˜ê¸°ì—…ìœ¡ì„±ì— ê´€í•œ íŠ¹ë³„ë²•ã€ì— ì˜ê±° ë²¤ì²˜ê¸°ì—…ì„ì„ í™•ì¸í•©ë‹ˆë‹¤."
        },
        'social': {
            title: "ì†Œì…œë²¤ì²˜ íŒë³„ í™•ì¸ì„œ",
            content: "<strong>íŒë³„ë²ˆí˜¸:</strong> 2025-SV-0152<br><strong>ê¸°ì—…ëª…:</strong> ì£¼ì‹íšŒì‚¬ ê·¸ë ˆì´íŠ¸í¼ì¦<br><strong>íŒë³„ê¸°ê´€:</strong> ê¸°ìˆ ë³´ì¦ê¸°ê¸ˆ<br><br>ìœ„ ê¸°ì—…ì€ ì‚¬íšŒì  ê°€ì¹˜ì™€ ê²½ì œì  ì„±ê³¼ë¥¼ ë™ì‹œì— ì°½ì¶œí•˜ëŠ” ì†Œì…œë²¤ì²˜ ê¸°ì—…ì„ì„ í™•ì¸í•©ë‹ˆë‹¤."
        }
    };

    function showCert(key, btn) {
        const area = document.getElementById('cert-display-area');
        const titleEl = document.getElementById('cert-title-text');
        const contentEl = document.getElementById('cert-content-text');
        
        if(btn.classList.contains('active')) {
            btn.classList.remove('active');
            area.classList.remove('show');
            return;
        }

        document.querySelectorAll('.cert-badge').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        titleEl.innerHTML = certData[key].title;
        contentEl.innerHTML = certData[key].content;
        area.classList.add('show');
    }

    function syncVal(type, val) {
        document.getElementById(`range-${type}`).value = val;
        document.getElementById(`input-${type}`).value = val;
        state[type] = parseInt(val);
        if(document.getElementById('resultArea').style.display === 'grid') calculate();
    }

    function openPopup() { 
        document.getElementById('solutionPopup').style.display = 'flex'; 
    }
    
    function closePopupAndShowResult() {
        document.getElementById('solutionPopup').style.display = 'none';
        document.getElementById('resultArea').style.display = 'grid';
        if(!myChart) initChart();
        calculate();
        document.getElementById('resultArea').scrollIntoView({ behavior: 'smooth' });
    }

    function setMode(mode, btn) {
        state.mode = mode;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        calculate();
    }

    function setTarget(rate, btn) {
        state.targetRate = rate;
        document.querySelectorAll('.target-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        calculate();
    }

    function calculate() {
        // 1. í˜„ì¬ ë¶€ë‹´ê¸ˆ ê³„ì‚°
        const mandatory = Math.floor(state.total * 0.031); 
        const currentRecognized = state.dis; 
        const unfilled = Math.max(0, mandatory - currentRecognized); 
        const ratio = mandatory > 0 ? currentRecognized / mandatory : 0;

        let unitCost = 0;
        let isExempt = false;

        if (state.total < 100) {
            unitCost = 0;
            isExempt = true;
            if(document.getElementById('exempt-msg')) document.getElementById('exempt-msg').style.display = 'block';
            document.getElementById('val-unfilled').style.color = '#2563eb';
        } else {
            if(document.getElementById('exempt-msg')) document.getElementById('exempt-msg').style.display = 'none';
            document.getElementById('val-unfilled').style.color = '#ef4444';
            
            for(let i=0; i<BURDEN_TIERS.length; i++) {
                if(ratio < BURDEN_TIERS[i].limit || i === BURDEN_TIERS.length-1) {
                    unitCost = (currentRecognized === 0 && mandatory > 0) ? BURDEN_TIERS[0].cost : BURDEN_TIERS[i].cost;
                    break;
                }
            }
        }

        const currentMonthlyLevy = unfilled * unitCost;
        const current5y = currentMonthlyLevy * 60;

        // UI ì—…ë°ì´íŠ¸
        document.getElementById('val-mandatory').innerText = mandatory;
        document.getElementById('val-current').innerText = currentRecognized;
        document.getElementById('val-unfilled').innerText = unfilled;
        document.getElementById('val-unit').innerText = (unitCost/10000).toLocaleString();
        document.getElementById('val-5yLevy').innerText = formatMoney(current5y);

        // 2. í•„ìš” ì±„ìš© ì¸ì› ê³„ì‚°
        const targetRecognizedTotal = Math.ceil(mandatory * state.targetRate);
        let gapRecognized = Math.max(0, targetRecognizedTotal - currentRecognized);
        const hires = Math.ceil(gapRecognized / 2); // ì¤‘ì¦ 2ë°°ìˆ˜
        const gainedRecognized = hires * 2;
        
        document.getElementById('sol-logic-text').innerText = `ë¶€ì¡± ${gapRecognized}ëª… Ã· 2 (ì¤‘ì¦ë”ë¸”) = ${hires}ëª… ì±„ìš©`;

        // 3. [ë¹„ìš© ê³„ì‚°] ì°¨íŠ¸ë¥¼ ìœ„í•´ 3ê°€ì§€ ëª¨ë“œ ëª¨ë‘ ê³„ì‚° (ë Œíƒˆ > í•˜ì´ë¸Œë¦¬ë“œ > êµ¬ë§¤ ìˆœì„œ ê²€ì¦ë¨)
        
        // A. ë Œíƒˆ (10% í• ì¸)
        const costRentalMonthly = (BASE_CONFIG.labor + (BASE_CONFIG.rentalMonthly * 0.9)) * hires;
        const costRental5y = costRentalMonthly * 60;

        // B. í•˜ì´ë¸Œë¦¬ë“œ (13% í• ì¸)
        const costHybridUpfront = (BASE_CONFIG.hybridDeposit * 0.87) * hires;
        const costHybridMonthly = (BASE_CONFIG.labor + (BASE_CONFIG.hybridRent * 0.87) + BASE_CONFIG.purchaseOp) * hires;
        const costHybrid5y = (costHybridMonthly * 60) + costHybridUpfront;

        // C. êµ¬ë§¤ (ìˆ˜ëŸ‰ë³„ í• ì¸)
        let discount = 0;
        let activeRowId = "row-t1";
        if(hires >= 31) { discount = 0.25; activeRowId = "row-t4"; }
        else if(hires >= 21) { discount = 0.20; activeRowId = "row-t3"; }
        else if(hires >= 11) { discount = 0.15; activeRowId = "row-t2"; }
        else { discount = 0; activeRowId = "row-t1"; }
        
        const costPurchaseDevice = (BASE_CONFIG.purchaseListPrice * (1 - discount)) * hires;
        const costPurchaseMonthly = (BASE_CONFIG.labor + BASE_CONFIG.purchaseOp) * hires;
        const costPurchase5y = (costPurchaseMonthly * 60) + costPurchaseDevice;

        // 4. ì”ì—¬ ë¶€ë‹´ê¸ˆ
        const remainUnfilled = Math.max(0, unfilled - gainedRecognized);
        let remainCost = 0;
        if(!isExempt && remainUnfilled > 0) {
            const newTotalRec = currentRecognized + gainedRecognized;
            const newRatio = mandatory > 0 ? newTotalRec/mandatory : 0;
            let newUnit = 0;
            for(let i=0; i<BURDEN_TIERS.length; i++) {
                if(newRatio < BURDEN_TIERS[i].limit || i === BURDEN_TIERS.length-1) {
                    newUnit = (newTotalRec === 0 && mandatory > 0) ? BURDEN_TIERS[0].cost : BURDEN_TIERS[i].cost;
                    break;
                }
            }
            remainCost = remainUnfilled * newUnit;
        }

        // 5. ì„ íƒëœ ëª¨ë“œì— ë”°ë¥¸ ìµœì¢… ê²°ê³¼ í‘œì‹œ
        let finalSolMonthly = 0;
        let finalTotal5y = 0;

        if(state.mode === 'purchase') {
            finalSolMonthly = costPurchaseMonthly + (costPurchaseDevice / 60); 
            finalTotal5y = costPurchase5y;
            document.querySelectorAll('.discount-table tr').forEach(tr => tr.classList.remove('active-tier'));
            document.getElementById(activeRowId).classList.add('active-tier');
        } else if(state.mode === 'rental') {
            finalSolMonthly = costRentalMonthly;
            finalTotal5y = costRental5y;
            document.querySelectorAll('.discount-table tr').forEach(tr => tr.classList.remove('active-tier'));
        } else { // hybrid
            finalSolMonthly = costHybridMonthly; // ì›” ì§€ì¶œì•¡ (ë³´ì¦ê¸ˆ ì œì™¸)
            finalTotal5y = costHybrid5y;
            document.querySelectorAll('.discount-table tr').forEach(tr => tr.classList.remove('active-tier'));
        }

        const totalMonthlyOut = finalSolMonthly + remainCost;
        const total5yWithRemain = finalTotal5y + (remainCost * 60);

        // ê²°ê³¼ê°’ UI ì—…ë°ì´íŠ¸
        document.getElementById('sol-hires').innerText = hires + " ëª…";
        document.getElementById('sol-monthly').innerText = parseInt(totalMonthlyOut).toLocaleString() + " ì›";
        document.getElementById('sol-remain').innerText = parseInt(remainCost).toLocaleString() + " ì›";
        document.getElementById('sol-total5y').innerText = formatMoney(total5yWithRemain);

        // ì ˆê°ì•¡ ê³„ì‚°
        const savingAmount = current5y - total5yWithRemain;
        const savingPct = current5y > 0 ? ((savingAmount / current5y) * 100).toFixed(1) : 0;
        
        const saveEl = document.getElementById('final-savings');
        const rateEl = document.getElementById('final-rate');
        
        if(savingAmount >= 0) {
            saveEl.innerText = formatMoney(savingAmount);
            saveEl.style.color = "#4ade80";
            rateEl.innerText = savingPct + "% ì ˆê°";
            rateEl.style.background = "#4ade80"; rateEl.style.color = "#064e3b";
        } else {
            saveEl.innerText = "+" + formatMoney(Math.abs(savingAmount));
            saveEl.style.color = "#ef4444";
            rateEl.innerText = "ë¹„ìš© ì¦ê°€";
            rateEl.style.background = "#ef4444"; rateEl.style.color = "white";
        }

        // [í•µì‹¬] ì°¨íŠ¸ ì—…ë°ì´íŠ¸ (ìƒ‰ìƒ ê°•ì¡° ë¡œì§ ì¶”ê°€ë¨)
        const remain5y = remainCost * 60;
        
        if(myChart) {
            // ê¸°ë³¸ ìƒ‰ìƒ: í˜„ì¬(Red), ë‚˜ë¨¸ì§€(Gray)
            let colors = ['#ef4444', '#cbd5e1', '#cbd5e1', '#cbd5e1'];
            
            // ì„ íƒëœ ëª¨ë“œë§Œ Blue(#2563eb)ë¡œ ë³€ê²½
            // Index: 0:í˜„ì¬, 1:ë Œíƒˆ, 2:í•˜ì´ë¸Œë¦¬ë“œ, 3:êµ¬ë§¤
            if(state.mode === 'rental') colors[1] = '#2563eb';
            else if(state.mode === 'hybrid') colors[2] = '#2563eb';
            else colors[3] = '#2563eb'; // purchase

            myChart.data.datasets[0].backgroundColor = colors;
            myChart.data.datasets[0].data = [
                current5y, 
                costRental5y + remain5y, 
                costHybrid5y + remain5y, 
                costPurchase5y + remain5y
            ];
            myChart.update();
        }
    }

    function formatMoney(n) {
        if(n >= 100000000) return (n/100000000).toFixed(1) + "ì–µì›";
        return Math.round(n).toLocaleString() + "ì›";
    }

    // ì°¨íŠ¸ ì´ˆê¸°í™” (4ê°œ ë§‰ëŒ€ ë¹„êµ)
    function initChart() {
        const ctx = document.getElementById('costChart').getContext('2d');
        myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['í˜„ì¬ ë¶€ë‹´ê¸ˆ', 'ë Œíƒˆí˜•(5ë…„)', 'í•˜ì´ë¸Œë¦¬ë“œ(5ë…„)', 'êµ¬ë§¤í˜•(Best)'],
                datasets: [{
                    label: '5ë…„ ì´ ë¹„ìš©',
                    data: [0, 0, 0, 0],
                    // ì´ˆê¸°ê°’: êµ¬ë§¤í˜•(index 3)ì´ ê¸°ë³¸ ì„ íƒì´ë¯€ë¡œ íŒŒë€ìƒ‰
                    backgroundColor: ['#ef4444', '#cbd5e1', '#cbd5e1', '#2563eb'],
                    borderRadius: 8,
                    barThickness: 40
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { 
                    legend: { display: false }, 
                    tooltip: { 
                        callbacks: { 
                            label: c => ' ë¹„ìš©: ' + (c.raw/100000000).toFixed(1) + 'ì–µì›' 
                        } 
                    } 
                },
                scales: {
                    y: { 
                        beginAtZero: true, 
                        ticks: { callback: v => (v/100000000).toFixed(0) + 'ì–µ' } 
                    },
                    x: { grid: { display: false } }
                }
            }
        });
    }
</script>

</body>
</html>
